---
title:  Züchtungslehre - Eigenschaften von BLUP-Zuchtwerten
author: Peter von Rohr
date: 2016-11-18
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results = 'asis')
```

```{r DocumentStatus, eval=FALSE}
r6obj_docstat <- rmddochelper::R6ClassDocuStatus$new()
r6obj_docstat$set_current_status(psVersion = "0.0.901",
                                 psStatus  = "Initialisation",
                                 psProject = "ZL_HS_2016")
r6obj_docstat$include_doc_stat(psTitle = "## Document Status")
```


```{r TableAbbreviation}
r6ob_abbrtable <- rmddochelper::R6ClassTableAbbrev$new()
### # include table of abbreviations only, if there are any
if (!r6ob_abbrtable$is_empty_abbr())
  r6ob_abbrtable$include_abbr_table(psAbbrTitle = "## Abbreviations")
```

## Einleitung
In diesem Kapitel werden die Eigenschaften von BLUP-Zuchtwerten genauer erklärt. Im letzten Kapitel hatten wir gesehen, dass die geschätzten Zuchtwerte eine Funktion der Beobachtungen ist. Tiere ohne phänotypische Beobachtungen erhalten Zuchtwerte über Verknüpfungen in der inversen Verwandtschaftsmatrix. Welche Beobachtungen in einem geschätzten Zuchtwert eine Rolle spielen wollen wir bei der Zerlegung der geschätzten Zuchtwerte analysieren.


## Vergleich verschiedener Zuchtwertschätzmethoden
Wir haben bisher eine Reihe von Zuchtwertschätzmethoden kennengelernt. Für den Vergleich sollen Zuchtwerte mit den zu vergleichenden Methoden aufgrund des gleichen Datensatzes geschätzt werden. Folgende Methoden werden miteinander verglichen.

- Zuchtwerte aufgrund von Eigenleistungen
- Zuchtwerte aufgrund von Nachkommenleistungen
- BLUP Zuchtwertschätzung mit Vatermodell
- BLUP Zuchtwertschätzung mit Tiermodell


### Daten
Als Datensatz verwenden wir die Zunahmen bis zu Absetzen aus dem letzten Kapitel. Die folgende Tabelle gibt nochmals eine Übersicht über das Datenmaterial.

```{r WwgDataSet, results='hide'}
nNrAniInPed <- 8
nIdxFirstAniWithData <- 4
dfWwg <- data.frame(Kalb = c(nIdxFirstAniWithData:nNrAniInPed),
                    Geschlecht = c("M","F","F","M","M"),
                    Vater = c(1,3,1,4,3),
                    Mutter = c(NA,2,2,5,6),
                    WWG = c(4.5,2.9,3.9,3.5,5.0))
sigmae2 <- 40
sigmaa2 <- 20
alpha <- sigmae2/sigmaa2
sigmap2 <- sigmaa2 + sigmae2
h2 <- sigmaa2 / sigmap2
```

```{r WwgDataSetShow}
knitr::kable(dfWwg)
```

Die Varianzkomponenten $\sigma_e^2$ und $\sigma_a^2$ sind bekannt und haben die Werte $\sigma_e^2 = `r sigmae2`$ und $\sigma_a^2 = `r sigmaa2`$.


### Zuchtwerte aufgrund von Eigenleistungen
Diese Methode ist die einfachste um Zuchtwerte zu schätzen. Sie ist aber auch sehr limitiert, da nur Tiere mit einer eigenen beobachteten Leistung einen Zuchtwert bekommen. Für alle anderen Tiere kann kein Zuchtwert geschätzt werden. Für unser Beispiel bedeutet das, dass die Tiere in folgender Tabelle einen geschätzten Zuchtwert erhalten. Der Einfachheit halber nehmen wir den Mittelwert der Beobachtungen als Populationsmittel an.

\pagebreak

```{r PredBvOwnPerf}
muWwg <- mean(dfWwg$WWG)
bvOwnPerf <- h2*(dfWwg$WWG - muWwg)
dfBvOwnPerf <- data.frame(Tier = dfWwg$Kalb, Zuchtwert = round(bvOwnPerf, digits = 3))
knitr::kable(dfBvOwnPerf)
```


### Zuchtwerte aufgrund von Nachkommenleistungen
```{r ParentsWithOffspringMean, echo=FALSE, results='hide'}
tabVater <- table(dfWwg$Vater)
tabMutter <- table(dfWwg$Mutter)
vEltern <- c(names(tabVater)[which(tabVater>1)],names(tabMutter)[which(tabMutter > 1)])
vEltern <- vEltern[order(vEltern)]
nNrEltern <- length(vEltern)
k <- (4-h2)/h2
```

Zuchtwerte aufgrund von Nachkommenleistungen zu schätzen, macht eigentlich nur dann Sinn, wenn ein Tier mehr als ein Nachkommen hat. Dies trifft bei unserem Datensatz für die Tiere `r vEltern[1:(nNrEltern-1)]` und `r vEltern[nNrEltern]` zu. Die geschätzten Zuchtwerte aufgrund von Nachkommendurchschnitten sind definiert als

$$\hat{a} = \frac{2n}{n+k}(\tilde{y} - \mu)$$

wobei $n$ für die Anzahl Nachkommen steht und $k$ als $(4-h^2)/h^2$ definiert ist. Für unser Beispiel gilt also, dass $k= `r k`$. Der Durchschnitt der phänotypischen Leistungen der Nachkommen wird mit $\tilde{y}$ bezeichnet. Als Populationsmittel $\mu$ verwenden wir wieder das Mittel aller phänotypischen Beobachtungen. Dieses beträgt $`r muWwg`$. Die folgende Tabelle gibt eine Übersicht über die verwendeten Werte und die geschätzten Zuchtwerte (Kolonnen `BV`).

```{r InfoBvOffspring, echo=FALSE}
vecNrOffSpring <- sapply(as.numeric(vEltern), function(x) return(length(which(dfWwg$Vater == x)) + 
                                                                                     length(which(dfWwg$Mutter == x))))
vecMeanOffspring <- sapply(as.numeric(vEltern), function(x) mean(dfWwg$WWG[c(which(dfWwg$Vater == x), which(dfWwg$Mutter == x))]))
vecBv <- 2*vecNrOffSpring/(vecNrOffSpring+k) * (vecMeanOffspring-muWwg)
dfInfoBvOffspring <- data.frame(Tier = vEltern,
                                n = vecNrOffSpring,
                                y = vecMeanOffspring,
                                BV = round(vecBv, digits = 3))
knitr::kable(dfInfoBvOffspring)
```

wobei die Anzahl Nachkommen in Kolonne `n` und die Nachkommendurchschnitte in Kolonne `y` aufgelistet sind.

Zusammenfassend können wir feststellen, dass die geschätzten Zuchtwerte eine tiefere Variabilität aufweisen als die phänotypischen Beobachtungen und die Nachkommendurchschnitte. Vergleichen wir die empirischen Standardabweichungen, wie in folgender Tabelle gezeigt, wird diese Reduktion der Variabilität deutlich.

```{r VarReduction, echo=FALSE}
dfVarRed <- data.frame(Zufallsvariable = c("phänotypische Beobachtungen", "Nachkommendurchschnitt", 
                                           "Zuchtwerte EL", "Zuchtwerte NL"),
                       Standardabweichung = round(c(sd(dfWwg$WWG), sd(vecMeanOffspring),
                                              sd(bvOwnPerf), sd(vecBv)), digits = 3))
knitr::kable(dfVarRed)
```

Es gilt aber zu beachten, dass diese Standardabweichungen auf sehr wenigen Beobachtungen basieren. Somit ist diese Beobachtung zunächst einmal einfach für diesen Datensatz gültig. 


### Das Vatermodell
Das Vatermodell gilt als eigentlicher Vorläufer des Tiermodells. Bei besonderen Datenkonstellationen wird dieses Modell aber heute noch in der Praxis - so zum Beispiel in der Fleischrinderzucht - eingesetzt. Beim Vatermodell handelt es sich auch wie beim Tiermodell um ein lineares gemischtes Modell. Die zufälligen Effekte des Vatermodells sind aber die sogenannten Vatereffekte und nicht wie im Tiermodell die Zuchtwerte. Aufgrund dieser Tatsache bekommen nur männliche Tiere einen Zuchtwert und es werden auch nur die Verwandtschaften über die väterlichen Pfade berücksichtigt. Beim Vatermodell nehmen wir an, dass alle Paarungspartner genetisch ähnlich sind zueinander. Dies kann zu Verzerrungen bei den geschätzten Zuchtwerten führen, falls eine gezielte Paarung praktiziert wird. Der Vorteil des Vatermodells liegt in der reduzierten Anzahl an Gleichungen, welche zu lösen sind.

In Matrixnotation lautet das Vatermodell

\begin{equation}
y = Xb + Zs + e
\label{eq:SireModel}
\end{equation}

Alle Terme in (\ref{eq:SireModel}) sind gleich definiert, wie im Tiermodell, ausser dass $s$ jetzt für den Vektor der zufälligen Vatereffekte steht und dass die Inzidenzmatrix $Z$ die Beobachtungen mit den Vatereffekten verknüpft. Die Varianzkomponenten der zufälligen Effekte lauten

\begin{equation}
var(s) = A\ \sigma_s^2
\label{eq:VarSireEffect}
\end{equation}

wobei $A$ die Verwandtschaftsmatrix zwischen den Vätern ist und $\sigma_s^2 = 0.25\sigma_a^2$ beträgt. Die Mischmodellgleichungen sind gleich, wie beim Tiermodell, ausser, dass 

$$\alpha = \frac{\sigma_e^2}{\sigma_s^2} = \frac{4-h^2}{h^2}$$

### Ein Beispiel



## Zerlegung eines mit dem Tiermodell geschätzten Zuchtwertes


```{r WriteTableOfAbbreviations, results='hide'}
r6ob_abbrtable$writeToTsvFile()
```
<!-- END of document                 -- 
  -- Below this must not be anything --> 
